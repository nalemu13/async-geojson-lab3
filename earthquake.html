<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <title>Earthquake List</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <!-- MapLibre CDN -->
  <script src="https://unpkg.com/maplibre-gl@^5.9.0/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@^5.9.0/dist/maplibre-gl.css" rel="stylesheet" />

  <style>
    body { margin: 0; padding: 0; }
    #container { display: flex; height: 100vh; flex-direction: row; align-items: stretch; }
    #side-panel { flex-basis: 500px; overflow-y: auto; padding: 16px; background: #fff; }
    #map { flex-grow: 1; }
    h2 { margin: 0 0 10px 0; }
    button { margin-bottom: 10px; cursor: pointer; }
    table { border-collapse: collapse; width: 100%; border: 1px solid #ddd; }
    th, td { text-align: left; padding: 8px; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    @media (max-width: 1024px) { #side-panel { display: none; } }
  </style>
</head>
<body>
  <main id="container">
    <div id="side-panel">
      <h2>Earthquake List</h2>
      <button id="sort-btn">Sort by Magnitude</button>
      <table id="eq-table">
        <tr>
          <th>ID</th>
          <th>Magnitude</th>
          <th>Timestamp</th>
        </tr>
      </table>
    </div>
    <div id="map"></div>
  </main>

  <script>
    // Initialize MapLibre map
    const map = new maplibregl.Map({
      container: 'map',
      center: [138, 38],
      zoom: 5.5,
      style: {
        "version": 8,
        "sources": {
          "satellite": {
            "type": "raster",
            "tiles": [
              "https://tiles.maps.eox.at/wmts/1.0.0/s2cloudless-2020_3857/default/g/{z}/{y}/{x}.jpg"
            ],
            "tileSize": 256
          }
        },
        "layers": [{ "id": "satellite", "type": "raster", "source": "satellite" }]
      }
    });

    async function geojsonFetch() {
      let response, earthquakes, japan;
      response = await fetch('assets/earthquakes.geojson');
      earthquakes = await response.json();
      response = await fetch('assets/japan.json');
      japan = await response.json();

      // Add layers once map loads
      map.on('load', () => {
        map.addSource('japan', { type: 'geojson', data: japan });
        map.addLayer({
          id: 'japan-layer',
          type: 'fill',
          source: 'japan',
          paint: { 'fill-color': '#0080ff', 'fill-opacity': 0.5 }
        });

        map.addSource('earthquakes', { type: 'geojson', data: earthquakes });
        map.addLayer({
          id: 'earthquakes-layer',
          type: 'circle',
          source: 'earthquakes',
          paint: {
            'circle-radius': 8,
            'circle-stroke-width': 2,
            'circle-color': 'red',
            'circle-stroke-color': 'white'
          }
        });
      });

      // Populate table
      const table = document.getElementById('eq-table');
      earthquakes.features.forEach(f => {
        const row = table.insertRow(-1);
        row.insertCell(0).innerText = f.properties.id;
        row.insertCell(1).innerText = f.properties.mag;
        row.insertCell(2).innerText = new Date(f.properties.time).toLocaleDateString("en-US");
      });

      // Sort button
      document.getElementById('sort-btn').addEventListener('click', () => {
        let rows, switching, i, x, y, shouldSwitch;
        switching = true;
        while (switching) {
          switching = false;
          rows = table.rows;
          for (i = 1; i < (rows.length - 1); i++) {
            shouldSwitch = false;
            x = parseFloat(rows[i].getElementsByTagName("td")[1].innerHTML);
            y = parseFloat(rows[i + 1].getElementsByTagName("td")[1].innerHTML);
            if (x < y) { shouldSwitch = true; break; }
          }
          if (shouldSwitch) {
            rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
            switching = true;
          }
        }
      });
    }

    geojsonFetch();
  </script>
</body>
</html>

